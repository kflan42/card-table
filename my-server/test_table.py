import random
import time

from magic_cards import MagicCards
from magic_table import MagicTable, Game, Zone
from magic_models import JoinRequest, CardMove, PlayerAction, CounterChange, CardChange, \
    CreateToken
from magic_constants import ZONES, LIBRARY, HAND, BATTLEFIELD, TOGGLE_TAP_CARD, TOGGLE_TRANSFORM_CARD, \
    TOGGLE_FACEDOWN_CARD

arena_deck = "1 Abzan Charm (C16) 177\r\n1 Acidic Slime \r\n1 Acolyte of Affliction (THB) 206\r\n1 Altar of Dementia (MH1) 218\r\n1 Blossoming Sands (IKO) 244\r\n1 Boneyard Lurker (IKO) 178\r\n1 Carrion Feeder \r\n1 Caustic Caterpillar \r\n1 Chittering Harvester (IKO) 80\r\n1 Corpse Knight (M20) 206\r\n1 Cruel Celebrant (WAR) 188\r\n1 Dawntreader Elk (DKA)\r\n1 Devoted Druid (SHM) 110\r\n1 Dirge Bat (IKO) 84\r\n1 Divine Reckoning (C19) 62\r\n1 Drown in Filth (GK1) 60\r\n1 Duneblast (C16) 194\r\n1 Elvish Rejuvenator (M19) 180\r\n1 Evolving Wilds (IKO) 247\r\n1 Explosive Vegetation \r\n1 Farhaven Elf (C18) 146\r\n1 Fertilid (IKO) 152\r\n1 Final Parting (DOM) 93\r\n1 Fleshbag Marauder (CN2) 136\r\n9 Forest (IKO) 272\r\n1 Forsaken Sanctuary (C18) 247\r\n1 Foul Orchard (C19) 244\r\n1 Funeral Rites (THB) 97\r\n1 Gaze of Granite (GK1) 61\r\n1 Gemrazer (IKO) 155\r\n1 Glowspore Shaman (GRN) 173\r\n1 Golgari Grave-Troll (DDJ) 60\r\n1 Golgari Rot Farm (C19) 248\r\n1 Grapple with the Past \r\n1 Graypelt Refuge \r\n1 Grisly Salvage (GK1) 64\r\n1 Guardian Project (RNA) 130\r\n1 Harrow \r\n1 Insatiable Hemophage (IKO) 93\r\n1 Jade Mage (C13) 151\r\n1 Jarad's Orders (RTR)\r\n1 Jungle Hollow (IKO) 249\r\n1 Mentor of the Meek (M19) 27\r\n1 Merciless Executioner (FRF) 76\r\n1 Migration Path (IKO) 164\r\n1 Migratory Greathorn (IKO) 165\r\n1 Moldervine Reclamation (M20) 214\r\n1 Necropanther (IKO) 196\r\n1 Nethroi, Apex of Death (IKO) 197 *CMDR*\r\n1 Nyx Weaver (JOU) 153\r\n1 Orzhov Basilica \r\n1 Path of Discovery (RIX) 142\r\n1 Perpetual Timepiece (KLD) 227\r\n1 Plaguecrafter (C19) 126\r\n3 Plains (IKO) 260\r\n1 Rampant Growth \r\n1 Ravenous Chupacabra \r\n1 Read the Bones \r\n1 Reclamation Sage (C18) 159\r\n1 Sakura-Tribe Elder \r\n1 Sandsteppe Citadel \r\n1 Satyr Wayfinder (CMA) 143\r\n1 Sawtusk Demolisher (C20) 64\r\n1 Scoured Barrens (IKO) 254\r\n1 Selesnya Sanctuary (C19) 272\r\n1 Shriekmaw \r\n1 Soul of the Harvest (E02) 36\r\n1 Springbloom Druid (MH1) 181\r\n1 Stinkweed Imp \r\n1 Stitcher's Supplier (M19) 121\r\n10 Swamp (IKO) 266\r\n1 Syphon Mind (C17) 127\r\n1 Syr Konrad, the Grim (ELD) 107\r\n1 Temple of Malady (M20) 254\r\n1 Terramorphic Expanse (C19) 281\r\n1 Tranquil Expanse (C18) 289\r\n1 Vindictive Vampire (RNA) 90\r\n1 Vizier of Remedies (AKH) 38\r\n1 Winding Way (MH1) 193\r\n1 Yavimaya Granger (ULG)\r\n1 Zulaport Cutthroat (BFZ) 126\r\n\r\n"
txt_deck = "1 Akroma's Memorial\r\n1 Asceticism\r\n1 Avenger of Zendikar\r\n1 Beast Whisperer\r\n1 Beast Within\r\n1 Boseiju, Who Shelters All\r\n1 Castle Garenbrig\r\n1 Collector Ouphe\r\n1 Concordant Crossroads\r\n1 Craterhoof Behemoth\r\n1 Creeping Renaissance\r\n1 Cultivate\r\n1 Defense Grid\r\n1 Defense of the Heart\r\n1 Deserted Temple\r\n1 Dryad Arbor\r\n1 Elvish Mystic\r\n1 Eternal Witness\r\n1 Fabled Passage\r\n1 Finale of Devastation\r\n22 Forest\r\n1 Gaea's Cradle\r\n1 Genesis Wave\r\n1 Green Sun's Zenith\r\n1 Hall of Gemstone\r\n1 Heroic Intervention\r\n1 Kamahl, Fist of Krosa *CMDR*\r\n1 Karametra's Acolyte\r\n1 Karn Liberated\r\n1 Kenrith's Transformation\r\n1 Kogla, the Titan Ape\r\n1 Krosan Grip\r\n1 Llanowar Elves\r\n1 Llanowar Tribe\r\n1 Lotus Cobra\r\n1 Lurking Predators\r\n1 Mana Reflection\r\n1 Miren, the Moaning Well\r\n1 Misty Rainforest\r\n1 Nacatl War-Pride\r\n1 Natural Order\r\n1 Nature's Will\r\n1 Nevinyrral's Disk\r\n1 Nissa's Pilgrimage\r\n1 Nissa, Vastwood Seer\r\n1 Nykthos, Shrine to Nyx\r\n1 Nylea's Intervention\r\n1 Nyxbloom Ancient\r\n1 Ohran Frostfang\r\n1 Oracle of Mul Daya\r\n1 Praetor's Counsel\r\n1 Priest of Titania\r\n1 Questing Beast\r\n1 Regal Force\r\n1 Regrowth\r\n1 Reliquary Tower\r\n1 Return of the Wildspeaker\r\n1 Rings of Brighthearth\r\n1 Rishkar's Expertise\r\n1 Scavenging Ooze\r\n1 Seedborn Muse\r\n1 Selvala's Stampede\r\n1 Selvala, Heart of the Wilds\r\n1 Shamanic Revelation\r\n1 Skyshroud Claim\r\n1 Song of the Dryads\r\n1 Soul of the Harvest\r\n1 Spike Weaver\r\n1 Spore Frog\r\n1 Sylvan Library\r\n1 The Great Henge\r\n1 Verdant Catacombs\r\n1 Vigor\r\n1 Vivien, Monsters' Advocate\r\n1 Vorinclex, Voice of Hunger\r\n1 Windswept Heath\r\n1 Wood Elves\r\n1 Wooded Foothills\r\n1 Woodfall Primus\r\n"
deck_w_side = "1 Angrath's Marauders (XLN) 132\r\n1 Arcane Signet (ELD) 331\r\n1 Ash Barrens \r\n1 Assemble the Legion \r\n1 Battlefield Forge (ORI) 244\r\n1 Blasphemous Act (C18) 120\r\n1 Boros Charm (GK1) 84\r\n1 Boros Signet (GK1) 97\r\n1 Bruse Tarl, Boorish Herder (C16) 30\r\n1 Captain of the Watch (DDO) 3\r\n1 Clifftop Retreat (DOM) 239\r\n1 Command Tower (ELD) 333\r\n1 Conch Horn (FEM)\r\n1 Deflecting Swat (C20) 50\r\n1 Dragon Fodder \r\n1 Eldrazi Monument \r\n1 Elspeth, Sun's Champion (DDO) 1\r\n1 Fervor (M13)\r\n1 Flawless Maneuver (C20)\r\n1 Fumigate (KLD) 15\r\n1 Geist-Honored Monk (C14) 72\r\n1 Generous Gift (MH1) 11\r\n1 Gerrard, Weatherlight Hero (C19) 41\r\n1 Goblin Instigator (M19) 142\r\n1 Goblin Rabblemaster (DDT) 46\r\n1 Goldnight Commander (AVR)\r\n1 Grand Abolisher (E01) 12\r\n1 Grenzo, Havoc Raiser (CN2) 54\r\n1 Hanged Executioner (M20) 22\r\n1 Homeward Path (C16) 301\r\n1 Hordeling Outburst (A25) 134\r\n1 Humble Defector (A25) 135\r\n1 Idol of Oblivion (C19) 55\r\n1 Iroas, God of Victory (C16) 205\r\n1 Kher Keep (C13)\r\n1 Krenko's Command \r\n1 Land Tax (BBD) 94\r\n1 Legion Warboss (GRN) 109\r\n1 Legion's Landing (XLN) 22\r\n1 Lena, Selfless Champion (M19) 21\r\n1 Lightning Greaves \r\n1 Loyal Apprentice (C18) 23\r\n1 Magus of the Wheel (C19) 149\r\n1 Mass Hysteria (MRD)\r\n1 Mentor of the Meek (M19) 27\r\n1 Mogg War Marshal \r\n1 Molten Birth (M14) 147\r\n12 Mountain (IKO) 269\r\n1 Myriad Landscape (C19) 261\r\n1 Not Forgotten (SOI) 30\r\n1 Penance (EXO)\r\n1 Pia and Kiran Nalaar (DDU) 47\r\n10 Plains (IKO) 260\r\n1 Purphoros, God of the Forge \r\n1 Raise the Alarm (M20) 34\r\n1 Reflecting Pool (CNS) 210\r\n1 Resolute Blademaster (BFZ) 218\r\n1 Rootborn Defenses \r\n1 Rugged Prairie (EVE)\r\n1 Sacred Foundry (GRN) 254\r\n1 Scavenger Grounds (HOU) 182\r\n1 Secure the Wastes (DTK) 36\r\n1 Selfless Spirit (EMN) 40\r\n1 Servo Exhibition (KLD) 27\r\n1 Silence (M14)\r\n1 Skullclamp \r\n1 Smothering Tithe (RNA) 22\r\n1 Sol Ring \r\n1 Stormfront Riders (DDF)\r\n1 Strip Mine (V09)\r\n1 Sunbaked Canyon (MH1) 247\r\n1 Talisman of Conviction (MH1) 230\r\n1 Teferi's Protection \r\n1 Temple of Triumph (M20) 257\r\n1 Tempt with Vengeance (C13) 125\r\n1 Thalia's Lancers \r\n1 Tome of Legends (ELD) 332\r\n1 Wear // Tear (DGM) 135\r\n1 Wheel of Fortune (G10)\r\n1 Winota, Joiner of Forces (IKO) 216 *CMDR*\r\n\r\n1 Break Through the Line (FRF) 94\r\n1 Chandra, Acolyte of Flame (M20) 126\r\n1 Dockside Extortionist (C19) 24\r\n1 Dolmen Gate (LRW)\r\n1 Impact Tremors \r\n1 Light Up the Stage (RNA) 107\r\n1 Make a Stand (M19)\r\n1 Satyr's Cunning (THB)\r\n1 Savage Beating (DST)\r\n1 Scroll Rack (TMP)\r\n1 Silverwing Squadron (ELD)\r\n1 Slate of Ancestry (EVG)\r\n1 Swiftfoot Boots (C18)\r\n1 Tectonic Reformation (MH1)\r\n1 Throne of the God-Pharaoh (AKH)"
tapped_out = "1 Alchemist's Refuge\r\n1 Altered Ego\r\n1 Asceticism\r\n1 Assassin's Trophy\r\n1 Bayou\r\n1 Birds of Paradise\r\n1 Bloom Tender\r\n1 Blue Sun's Zenith\r\n1 Castle Garenbrig\r\n1 Cavern of Souls\r\n1 Chromatic Lantern\r\n1 City of Brass\r\n1 Command Tower\r\n1 Cyclonic Rift\r\n1 Damnation\r\n1 Darkslick Shores\r\n1 Deepglow Skate\r\n1 Demonic Tutor\r\n1 Dosan the Falling Leaf\r\n1 Doubling Season\r\n1 Dryad Arbor\r\n1 Elves of Deep Shadow\r\n1 Elvish Archdruid\r\n1 Elvish Mystic\r\n1 Exotic Orchard\r\n1 Expedition Map\r\n1 Exsanguinate\r\n1 Feral Hydra\r\n1 Nissa, Vastwood Seer\r\n6 Forest\r\n1 Freed from the Real\r\n1 Fyndhorn Elves\r\n1 Gaea's Cradle\r\n1 Gaea's Herald\r\n1 Gargos, Vicious Watcher\r\n1 Genesis Hydra\r\n1 Genesis Wave\r\n1 Green Sun's Zenith\r\n1 Grim Monolith\r\n1 Guardian Project\r\n1 Heroic Intervention\r\n1 Hooded Hydra\r\n1 Hungering Hydra\r\n1 Hydroid Krasis\r\n2 Island\r\n1 Karn's Bastion\r\n1 Krosan Grip\r\n1 Kruphix, God of Horizons\r\n1 Leyline of Anticipation\r\n1 Lifeblood Hydra\r\n1 Llanowar Elves\r\n1 Mana Confluence\r\n1 Mana Reflection\r\n1 Mistcutter Hydra\r\n1 Misty Rainforest\r\n1 Morphic Pool\r\n1 Muldrotha, the Gravetide\r\n1 Mystic Remora\r\n1 Oko, Thief of Crowns\r\n1 Path of Ancestry\r\n1 Pemmin's Aura\r\n1 Phyrexian Arena\r\n1 Polluted Delta\r\n1 Power Artifact\r\n1 Priest of Titania\r\n1 Primordial Hydra\r\n1 Pull from Tomorrow\r\n1 Reflecting Pool\r\n1 Rhystic Study\r\n1 Selvala, Heart of the Wilds\r\n1 Sol Ring\r\n1 Song of the Dryads\r\n1 Steelbane Hydra\r\n1 Stonecoil Serpent\r\n1 Stroke of Genius\r\n1 Swamp\r\n1 Sylvan Library\r\n1 Temple of the False God\r\n1 The Great Henge\r\n1 Torment of Hailfire\r\n1 Toxic Deluge\r\n1 Triumph of the Hordes\r\n1 Tropical Island\r\n1 Unbound Flourishing\r\n1 Underground River\r\n1 Underground Sea\r\n1 Urborg, Tomb of Yawgmoth\r\n1 Vampiric Tutor\r\n1 Vastwood Hydra\r\n1 Verdant Catacombs\r\n1 Villainous Wealth\r\n1 Voracious Hydra\r\n1 Watery Grave\r\n1 Zaxara, the Exemplary"
xmage_deck = "1 [LEB:287] Volcanic Island\r\n1 [LEB:278] Badlands\r\n1 [LEB:286] Underground Sea\r\n1 [KTK:243] Swiftwater Cliffs\r\n1 [TSP:279] Terramorphic Expanse\r\n1 [M12:226] Drowned Catacomb\r\n1 [PCA:131] Vivid Creek\r\n1 [ELD:241] Castle Locthwain\r\n1 [UDS:52] Attrition\r\n1 [IMA:235] Evolving Wilds\r\n1 [WWK:139] Lavaclaw Reaches\r\n1 [M15:224] Perilous Vault\r\n1 [V13:17] Cruel Ultimatum\r\n1 [RIX:90] Vona's Hunger\r\n1 [C15:260] Orochi Hatchery\r\n1 [ONS:104] Read the Runes\r\n1 [MPS:13] Hangarback Walker\r\n1 [SOM:190] Palladium Myr\r\n1 [AVR:50] Elgaud Shieldmate\r\n1 [ELD:232] Sorcerer's Broom\r\n1 [ELD:237] Witch's Oven\r\n1 [RNA:83] Priest of Forgotten Gods\r\n1 [MM2:71] Bitterblossom\r\n1 [SOM:137] Argentum Armor\r\n1 [HOU:140] Nicol Bolas, God-Pharaoh\r\n1 [DOM:90] The Eldest Reborn\r\n1 [C17:236] Bloodfell Caves\r\n1 [ODY:145] Innocent Blood\r\n1 [BNG:164] Temple of Malice\r\n1 [EMA:147] Siege-Gang Commander\r\n1 [PLC:165] Urborg, Tomb of Yawgmoth\r\n1 [CHK:282] Shinka, the Bloodsoaked Keep\r\n1 [HOU:77] Torment of Hailfire\r\n1 [M10:223] Dragonskull Summit\r\n1 [MM3:225] Rakdos Signet\r\n1 [GTC:249] Watery Grave\r\n1 [C15:170] Vandalblast\r\n1 [MMA:213] Relic of Progenitus\r\n1 [CMA:69] Syphon Flesh\r\n1 [DOM:102] Rite of Belzenlok\r\n1 [AKH:82] Bontu the Glorified\r\n1 [AER:128] Dark Intimations\r\n1 [NEM:59] Mind Slash\r\n1 [DOM:49] Curator's Ward\r\n1 [C15:302] Rogue's Passage\r\n1 [FRF:62] Archfiend of Depravity\r\n1 [ULG:62] Phyrexian Plaguelord\r\n1 [SCG:49] Rush of Knowledge\r\n1 [GTC:74] Ogre Slumlord *CMDR*\r\n1 [MPS:14] Lightning Greaves\r\n1 [APC:142] Shivan Reef\r\n1 [ELD:392] Piper of the Swarm\r\n1 [E02:45] Crumbling Necropolis\r\n1 [WWK:134] Creeping Tar Pit\r\n1 [A25:234] Swiftfoot Boots\r\n1 [JR:98] Damnation\r\n1 [DOM:247] Sulfur Falls\r\n1 [DDJ:17] Izzet Signet\r\n1 [SOK:62] Choice of Damnations\r\n1 [STH:71] Stronghold Assassin\r\n1 [UDS:139] Thran Dynamo\r\n1 [C17:254] Grixis Panorama\r\n1 [DOM:108] Torgaar, Famine Incarnate\r\n1 [RTR:247] Steam Vents\r\n1 [MPS:28] Sword of Feast and Famine\r\n1 [MRD:255] Talisman of Indulgence\r\n1 [WAR:204] Mayhem Devil\r\n1 [C17:246] Dismal Backwater\r\n1 [DOM:100] Phyrexian Scriptures\r\n1 [TSP:161] Greater Gargadon\r\n1 [JOU:52] Sigiled Starfish\r\n1 [MBS:67] Into the Core\r\n1 [DTK:65] Negate\r\n1 [THS:65] Swan Song\r\n1 [SCG:143] Temple of the False God\r\n1 [TMP:86] Shadow Rift\r\n1 [BNG:66] Eater of Hope\r\n1 [V13:12] Gilded Lotus\r\n1 [DST:160] Whispersilk Cloak\r\n1 [MPS:24] Sol Ring\r\n1 [DST:165] Mirrodin's Core\r\n1 [5DN:39] Trinket Mage\r\n1 [LEA:54] Counterspell\r\n1 [MPS:8] Chromatic Lantern\r\n1 [THS:225] Temple of Deceit\r\n1 [ALA:101] Goblin Assault\r\n1 [DTK:232] Silumgar's Command\r\n1 [PLS:48] Nightscape Familiar\r\n1 [ELD:101] Rankle, Master of Pranks\r\n1 [MIR:340] Swamp\r\n1 [BFZ:263] Swamp\r\n1 [LEA:291] Swamp\r\n1 [M12:235] Island\r\n1 [S99:159] Island\r\n1 [USG:344] Mountain\r\n1 [PC2:142] Swamp\r\n1 [MBS:153] Mountain\r\n1 [CMA:245] Command Tower\r\n1 [ISD:71] Rooftop Storm\r\nSB: 1 [ARB:113] Thraximundar\r\n"
tcgplayer_deck = "1 Sensei's Divining Top [CHK]\r\n1 Finale of Devastation [WAR]\r\n1 Boseiju, Who Shelters All [CHK]\r\n1 Heroic Intervention [AER]\r\n1 Primordial Hydra [M13]\r\n1 Freyalise, Llanowar's Fury [C14]\r\n1 Kamahl, Fist of Krosa [ONS]\r\n1 Miren, the Moaning Well [SOK]\r\n1 Fauna Shaman [M11]\r\n1 Nissa, Who Shakes the World [WAR]\r\n1 Lightning Greaves [MRD]\r\n1 Lurking Predators [M10]\r\n1 Emerald Medallion [C14]\r\n1 Primeval Bounty [M14]\r\n1 Rishkar's Expertise [AER]\r\n1 Eternal Witness [C15]\r\n1 Selvala's Stampede [CN2]\r\n1 Ezuri's Predation [C15]\r\n1 Sol Ring [C16]\r\n1 Goreclaw, Terror of Qal Sisma [M19] *CMDR*\r\n1 Elvish Piper [A25]\r\n1 Krosan Grip [C13]\r\n1 Reliquary Tower [M19]\r\n1 Prowling Serpopard [AKH]\r\n1 Spearbreaker Behemoth [ALA]\r\n1 Soul's Majesty [C17]\r\n1 Thunderfoot Baloth [C14]\r\n1 Multani, Maro-Sorcerer [ULG]\r\n1 Swiftfoot Boots [C13]\r\n1 Kodama's Reach [CHK]\r\n1 Beast Whisperer [GRN]\r\n1 Sakura-Tribe Scout [SOK]\r\n1 Garruk, Primal Hunter [C19]\r\n1 Beast Within [CN2]\r\n1 Wirewood Channeler [LGN]\r\n1 Cultivate [C17]\r\n1 Yeva, Nature's Herald [M13]\r\n1 Elemental Bond [C17]\r\n1 Oran-Rief, the Vastwood [C14]\r\n1 Explosive Vegetation [ONS]\r\n1 Elvish Archdruid [M11]\r\n1 Siege Behemoth [CMA]\r\n1 Overwhelming Stampede [MM2]\r\n1 Skyshroud Claim [NMS]\r\n1 Sandwurm Convergence [AKH]\r\n1 Shamanic Revelation [C19]\r\n1 Llanowar Tribe [MH1]\r\n1 Drumhunter [ALA]\r\n1 Harmonize (Garruk vs Liliana) [DD3]\r\n1 Mosswort Bridge [C15]\r\n1 Engulfing Slagwurm [SOM]\r\n1 Drove of Elves [SHM]\r\n3 Forest (304) [CHK]\r\n1 Temple of the False God [C16]\r\n1 Dungrove Elder [MB1]\r\n1 Rhonas's Monument [AKH]\r\n1 Paleoloth [CON]\r\n1 End-Raze Forerunners [RNA]\r\n1 Arbor Elf [WWK]\r\n1 Colossal Majesty [C19]\r\n1 Grave Sifter [C14]\r\n1 Bellowing Tanglewurm [SOM]\r\n1 Brawn [EMA]\r\n1 Forest (254) - Full Art [AKH]\r\n1 Garruk's Horde [M12]\r\n1 Forest (273) [BFZ]\r\n1 Forest (382) [10E]\r\n1 Terra Stomper [ORI]\r\n2 Forest (305) [CHK]\r\n1 Mana Geode [WAR]\r\n1 Tranquil Thicket [ONS]\r\n3 Forest (306) [CHK]\r\n2 Forest (303) [CHK]\r\n1 Caller of the Pack [C15]\r\n1 Sentinel Totem [XLN]\r\n1 Spawning Grounds [C18]\r\n1 Forest (247) [THS]\r\n1 Forest (269) [KTK]\r\n1 Forest (263) [DTK]\r\n1 Forest (266) [KTK]\r\n2 Forest (268) [KTK]\r\n1 Forest (271) [ORI]\r\n1 Indrik Stomphowler [C15]\r\n2 Forest (264) [KLD]\r\n1 Forest (248) [M13]\r\n1 Gale Force [CHK]\r\n1 Plated Crusher [BBD]\r\n1 Forest (199) [HOU]\r\n1 Forest (262) [KLD]\r\n1 Forest (198) [HOU]\r\n1 Band Together [WAR]\r\n1 Slice in Twain [C19]"
pioneer_60 = "4 Blood Crypt (RNA) 245\n3 Bonecrusher Giant (ELD) 115\n3 Canyon Slough (AKH) 239\n2 Castle Locthwain (ELD) 241\n2 Chandra, Torch of Defiance (KLD) 110\n2 Collective Brutality \n4 Dragonskull Summit (XLN) 252\n2 Dreadbore (E01) 83\n2 Fatal Push (AER) 57\n2 Foreboding Ruins (SOI) 272\n3 Goblin Rabblemaster (DDT) 46\n2 Hazoret the Fervent (AKH) 136\n3 Kolaghan's Command \n3 Kroxa, Titan of Death's Hunger (THB) 221\n4 Mountain (IKO) 269\n3 Murderous Rider (ELD) 97\n4 Soul-Scar Mage (AKH) 148\n3 Swamp (IKO) 266\n4 Thoughtseize \n1 Urborg, Tomb of Yawgmoth (M15) 248\n4 Wild Slash (FRF) 118\n\n2 Angrath's Rampage (WAR) 185\n1 Ashiok, Dream Render (WAR) 228\n1 Chandra, Acolyte of Flame (M20) 126\n2 Damping Sphere (DOM) 213\n2 Duress \n2 Goblin Chainwhirler (DOM) 129\n2 Noxious Grasp (M20) 110\n2 Rakdos Charm (C17) 190\n"
archi_deck = "1x Abomination of Llanowar (cmr) [Aggression] \n1x Abzan Charm (c20) [Removal] \n1x Adun Oakenshield (me1) [Pricey{noDeck}{noPrice}] \n1x Angus Mackenzie (leg) [Pricey{noDeck}{noPrice}] \n1x Animar, Soul of Elements (a25) [Ramp] \n1x Arcane Signet (cmr)\n1x Arixmethes, Slumbering Isle (2xm) [Ramp] \n1x Assassin's Trophy (grn) [Pricey{noDeck}{noPrice}] \n1x Bant Charm (c18) [Removal] \n1x Barkchannel Pathway // Tidechannel Pathway (khm)\n1x Beast Within (cmr) [Removal] \n1x Bountiful Promenade (bbd) [Pricey{noDeck}{noPrice}] \n1x Branchloft Pathway // Boulderloft Pathway (znr)\n1x Brawn (uma) [Evasion] \n1x Captain Sisay (inv) [Card Advantage] \n1x Chevill, Bane of Monsters (iko) [Card Advantage] \n1x Chulane, Teller of Tales (eld) [Card Advantage] \n1x Command Tower (cmr)\n1x Consign to Dust (c18) [Removal] \n1x Cragcrown Pathway // Timbercrown Pathway (znr)\n1x Crosis's Catacombs (pls) [-SlowLand{noDeck}{noPrice}] \n1x Crosis's Charm (mb1) [Removal] \n1x Crystal Quarry (ody)\n1x Darigaaz's Caldera (pls)\n1x Darkbore Pathway // Slitherbore Pathway (khm)\n1x Dromar's Cavern (pls) [- Slow Land{noDeck}{noPrice}] \n1x Dwynen, Gilt-Leaf Daen (ddu) [Anti Air] \n1x Edric, Spymaster of Trest (c16) [Card Advantage] \n1x Eladamri, Lord of Leaves (tmp) [Pricey{noDeck}{noPrice}] \n1x Emmara, Soul of the Accord (grn) [Aggression] \n1x Esika, God of the Tree // The Prismatic Bridge (khm) [Commander{top}] \n1x Ezuri, Claw of Progress (c15) [Pricey{noDeck}{noPrice}] \n1x Ezuri, Renegade Leader (ddu) *F*  [Evasion] \n1x Force of Vigor (mh1) [Removal] \n9x Forest (khm) 398\n1x Fracturing Gust (shm) [Removal] \n1x Frontier Bivouac (c20) [- Slow Land{noDeck}{noPrice}] \n1x Generous Gift (cmr) [Removal] \n1x Ghalta, Primal Hunger (jmp) [Evasion] \n1x Gilt-Leaf Palace (lrw)\n1x Glissa Sunseeker (mrd) [Removal] \n1x Glissa, the Traitor (mbs) [Aggression] \n1x God-Eternal Rhonas (war) [Aggression] \n1x Golgari Charm (uma) [Removal] \n1x Golgari Signet (cm2)\n1x Grand Warlord Radha (dom) [Ramp] \n1x Gravity Well (roe) [Anti Air] \n1x Grixis Charm (c13) [Removal] \n1x Gruul Signet (mm3)\n1x Heroic Intervention (m21)\n1x Hurricane (mb1) [Anti Air] \n1x Island (khm) 395\n1x Jungle Shrine (znc) [- Slow Land{noDeck}{noPrice}] \n1x Kamahl, Fist of Krosa (arc) [Evasion] \n1x Kamahl, Heart of Krosa (cmr) [Evasion] \n1x Karametra, God of Harvests (c20) [Ramp] \n1x Kaysa (all) [Aggression] \n1x Kessig Wolf Run (c20) [Evasion] \n1x Kethis, the Hidden Hand (m20) [Card Advantage] \n1x Klothys, God of Destiny (thb) [Aggression] \n1x Kolvori, God of Kinship // The Ringhart Crest (khm) [Ramp] \n1x Krosan Grip (c20) [Removal] \n1x Kruphix, God of Horizons (jou) [Ramp] \n1x Lathril, Blade of the Elves (khc) [Evasion] \n1x Maralen of the Mornsong (mor) [Pricey{noDeck}{noPrice}] \n1x Marwyn, the Nurturer (dom) [Ramp] \n1x Mina and Denn, Wildborn (znc) [Evasion] \n1x Momir Vig, Simic Visionary (dis) [Card Advantage] \n1x Mountain (khm) 397\n1x Nath of the Gilt-Leaf (c16) [Aggression] \n1x Nissa, Vastwood Seer // Nissa, Sage Animist (ori) [Pricey{noDeck}{noPrice}] \n1x Nylea, God of the Hunt (ths) [Evasion] \n1x Nylea, Keen-Eyed (thb) [Ramp] \n1x Opulent Palace (c20) [- Slow Land{noDeck}{noPrice}] \n2x Plains (khm) 394\n1x Radha, Heart of Keld (m21) [Aggression] \n1x Rashmi, Eternities Crafter (c20) [Card Advantage] \n1x Rejuvenating Springs (cmr)\n1x Rhonas the Indomitable (akh) [Evasion] \n1x Rishkar, Peema Renegade (aer) [Ramp] \n1x Rith's Grove (pls) [- Slow Land{noDeck}{noPrice}] \n1x Sandsteppe Citadel (c20)\n1x Sandwurm Convergence (akh) [Anti Air] \n1x Savage Lands (c18) [- Slow Land{noDeck}{noPrice}] \n1x Seaside Citadel (c18)\n1x Selesnya Sanctuary (znc)\n1x Selesnya Signet (cma)\n1x Selvala, Explorer Returned (c16) [Ramp] \n1x Selvala, Heart of the Wilds (jmp) [Pricey{noDeck}{noPrice}] \n1x Simic Growth Chamber (cmr)\n1x Simic Signet (cmr)\n1x Skarrg, the Rage Pits (pca) [Evasion] \n1x Sol Ring (cmr)\n1x Spire Garden (bbd) [Pricey{noDeck}{noPrice}] \n1x Storrev, Devkarin Lich (war) [Card Advantage] \n1x Swamp (khm) 396\n1x Swords to Plowshares (cmr) [Removal] \n1x Temple of Abandon (thb) [- Slow Land{noDeck}{noPrice}] \n1x Temple of Malady (m21) [- Slow Land{noDeck}{noPrice}] \n1x Temple of Mystery (m21) [- Slow Land{noDeck}{noPrice}] \n1x Temple of Plenty (thb) [- Slow Land{noDeck}{noPrice}] \n1x The World Tree (khm)\n1x Tolsimir Wolfblood (rav) [Aggression] \n1x Tolsimir, Friend to Wolves (war) [Aggression] \n1x Toski, Bearer of Secrets (khm) [Card Advantage] \n1x Traxos, Scourge of Kroog (dom) [Evasion] \n1x Treva's Ruins (pls)\n1x Tyvar Kell (khm) [Pricey{noDeck}{noPrice}] \n1x Undergrowth Stadium (cmr)\n1x Vindicate (a25) [Removal] \n1x Weatherlight (dom)\n1x Wirewood Lodge (evg)\n1x Wonder (cm2) [maybe{noDeck}{noPrice}] \n1x Xenagos, God of Revels (bng) [Pricey{noDeck}{noPrice}] \n1x Yeva, Nature's Herald (ddu) [Card Advantage] \n1x Zacama, Primal Calamity (rix) [Pricey{noDeck}{noPrice}] "
archi_txt = "1 Abomination of Llanowar\n1 Abzan Charm\n1 Animar, Soul of Elements\n1 Arcane Signet\n1 Arixmethes, Slumbering Isle\n1 Bant Charm\n1 Barkchannel Pathway // Tidechannel Pathway\n1 Beast Within\n1 Branchloft Pathway // Boulderloft Pathway\n1 Brawn\n1 Captain Sisay\n1 Chevill, Bane of Monsters\n1 Chulane, Teller of Tales\n1 Command Tower\n1 Consign to Dust\n1 Cragcrown Pathway // Timbercrown Pathway\n1 Crosis's Charm\n1 Crystal Quarry\n1 Darigaaz's Caldera\n1 Darkbore Pathway // Slitherbore Pathway\n1 Dwynen, Gilt-Leaf Daen\n1 Edric, Spymaster of Trest\n1 Emmara, Soul of the Accord\n1 Esika, God of the Tree // The Prismatic Bridge *CMDR*\n1 Ezuri, Renegade Leader\n1 Force of Vigor\n9 Forest\n1 Fracturing Gust\n1 Generous Gift\n1 Ghalta, Primal Hunger\n1 Gilt-Leaf Palace\n1 Glissa Sunseeker\n1 Glissa, the Traitor\n1 God-Eternal Rhonas\n1 Golgari Charm\n1 Golgari Signet\n1 Grand Warlord Radha\n1 Gravity Well\n1 Grixis Charm\n1 Gruul Signet\n1 Heroic Intervention\n1 Hurricane\n1 Island\n1 Kamahl, Fist of Krosa\n1 Kamahl, Heart of Krosa\n1 Karametra, God of Harvests\n1 Kaysa\n1 Kessig Wolf Run\n1 Kethis, the Hidden Hand\n1 Klothys, God of Destiny\n1 Kolvori, God of Kinship // The Ringhart Crest\n1 Krosan Grip\n1 Kruphix, God of Horizons\n1 Lathril, Blade of the Elves\n1 Marwyn, the Nurturer\n1 Mina and Denn, Wildborn\n1 Momir Vig, Simic Visionary\n1 Mountain\n1 Nath of the Gilt-Leaf\n1 Nylea, God of the Hunt\n1 Nylea, Keen-Eyed\n2 Plains\n1 Radha, Heart of Keld\n1 Rashmi, Eternities Crafter\n1 Rejuvenating Springs\n1 Rhonas the Indomitable\n1 Rishkar, Peema Renegade\n1 Sandsteppe Citadel\n1 Sandwurm Convergence\n1 Seaside Citadel\n1 Selesnya Sanctuary\n1 Selesnya Signet\n1 Selvala, Explorer Returned\n1 Simic Growth Chamber\n1 Simic Signet\n1 Skarrg, the Rage Pits\n1 Sol Ring\n1 Storrev, Devkarin Lich\n1 Swamp\n1 Swords to Plowshares\n1 The World Tree\n1 Tolsimir Wolfblood\n1 Tolsimir, Friend to Wolves\n1 Toski, Bearer of Secrets\n1 Traxos, Scourge of Kroog\n1 Treva's Ruins\n1 Undergrowth Stadium\n1 Vindicate\n1 Weatherlight\n1 Wirewood Lodge\n1 Yeva, Nature's Herald\n\nPricey\n1 Adun Oakenshield\n1 Angus Mackenzie\n1 Assassin's Trophy\n1 Bountiful Promenade\n1 Eladamri, Lord of Leaves\n1 Ezuri, Claw of Progress\n1 Maralen of the Mornsong\n1 Nissa, Vastwood Seer // Nissa, Sage Animist\n1 Selvala, Heart of the Wilds\n1 Spire Garden\n1 Tyvar Kell\n1 Xenagos, God of Revels\n1 Zacama, Primal Calamity\n\n-SlowLand\n1 Crosis's Catacombs\n1 Dromar's Cavern\n1 Frontier Bivouac\n1 Jungle Shrine\n1 Opulent Palace\n1 Rith's Grove\n1 Savage Lands\n1 Temple of Abandon\n1 Temple of Malady\n1 Temple of Mystery\n1 Temple of Plenty\n\nmaybe\n1 Wonder\n\n"

def get_zone(game: Game, player: str, zone: str) -> Zone:
    return [z for z in game.zones if z.owner == player and z.name == zone][0]


def test_table(name: str) -> MagicTable:
    table = MagicTable(name)
    # add players
    for player, deck, color in [
        ('Arena 1', arena_deck, 'Green'),
        ('Text 2', txt_deck, 'Red'),
        ('Side 3', deck_w_side, 'Blue'),
        ('T Out 4', tapped_out, 'White'),
        ('Std 5', pioneer_60, 'Black'),
    ]:
        d, s = MagicCards.resolve_decklist(deck)
        table.add_player(JoinRequest(name=player, table='test', deck=d, sideboard=s, color=color))

    # make it busy
    game = table.table.game
    for player in game.players:
        zs = {z: get_zone(game, player.name, z) for z in ZONES}

        pa = PlayerAction(kind='Draw', who=player.name, when=round(time.time() * 1000),
                          card_moves=[],
                          card_changes=[],
                          counter_changes=[],
                          create_tokens=[]
                          )
        d = PlayerAction.from_dict(pa.to_dict())
        d.kind = 'Draw'
        d.when = round(time.time() * 1000)
        d.card_moves = [CardMove(card_id=c, src_zone=LIBRARY, src_owner=player.name,
                                 tgt_zone=HAND, tgt_owner=player.name) for c in zs[LIBRARY].cards[:7]]
        table.resolve_action(d)

        cc = PlayerAction.from_dict(pa.to_dict())
        cc.when = round(time.time() * 1000)
        cc.counter_changes = [CounterChange(name="C. Casts", value=2, player=player.name)]
        table.resolve_action(cc)

        cm = PlayerAction.from_dict(pa.to_dict())
        cm.when = round(time.time() * 1000)
        cm.card_moves = [CardMove(card_id=c, src_zone=LIBRARY, src_owner=player.name,
                                  tgt_zone=BATTLEFIELD, tgt_owner=player.name) for c in zs[LIBRARY].cards[:7]]
        cm.card_changes = [CardChange(card_id=c, change="", to_x=c % 75, to_y=c % 60) for c in zs[LIBRARY].cards[:7]]
        table.resolve_action(cm)

        ce = PlayerAction.from_dict(pa.to_dict())
        ce.when = round(time.time() * 1000)
        ce.card_changes = [
            CardChange(card_id=zs[BATTLEFIELD].cards[0], change=TOGGLE_TAP_CARD),
            CardChange(card_id=zs[BATTLEFIELD].cards[1], change=TOGGLE_TRANSFORM_CARD),
            CardChange(card_id=zs[BATTLEFIELD].cards[2], change=TOGGLE_FACEDOWN_CARD),
        ]
        ce.counter_changes = [
            CounterChange(name="+1/+1", value=1, card_id=zs[BATTLEFIELD].cards[3])
        ]
        ce.create_tokens = [
            CreateToken(owner=player.name, sf_id=random.choice(MagicCards.get_all_tokens()).sf_id)
        ]
        table.resolve_action(ce)

    return table
